parameters:
  - name: environments
    type: object
    default:
      envName: 'name'
      dependsOn: []
      infrastructureName: 'infrastructureName'
      backendAzureRmResourceGroupName: 'backendAzureRmResourceGroupName'
      tfVarsFileName: 'tfVarsFileName'

stages:
  - ${{ each env in parameters.environments}}:
    - stage: ${{ env.envName }}
      jobs: 
      - template: Templates\Jobs\Terraform\terraform-apply-job.yml@corePipelineTemplates
        parameters:
          name: SharedInfrastructure
          workingDirectory: $(System.DefaultWorkingDirectory)/SharedInfrastructure/SharedInfrastructure/Terraform
          backendAzureRmResourceGroupName: rg-terraform-dev
          backendAzureRmStorageAccountName: terraformdev8716912495
          backendAzureRmContainerName: shared-infrastructure
          planCommandOptions: '-var-file="EnvironmentVariables/${{ parameters.tfVarsFileName }}"'
