parameters:
- name: name
- name: terraformWorkingDir
- name: environmentServiceName
  default: 'Azure subscription 1(19b03c4d-996a-4046-986e-e12c5b098db7)'

steps:
- task: TerraformCLI@1
  displayName: 'Terraform Plan ${{ parameters.name }}'
  inputs:
    command: 'plan'
    workingDirectory: ${{ parameters.terraformWorkingDir }}
    environmentServiceName: ${{ parameters.environmentServiceName }}
    allowTelemetryCollection: true
    publishPlanResults: ${{ parameters.name }}
    commandOptions: '-out=$(System.DefaultWorkingDirectory)/${{ parameters.name }}_terraform.tfplan -detailed-exitcode'

