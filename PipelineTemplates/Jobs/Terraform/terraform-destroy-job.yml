parameters:
- name: name
- name: terraformWorkingDir
- name: backendAzureRmContainerName
- name: environmentServiceName
  default: 'Azure subscription 1(19b03c4d-996a-4046-986e-e12c5b098db7)'
- name: azServiceConnection
  default: 'terraform-azure-connection'
- name: backendAzureRmResourceGroupName
  default: 'terraform-prod'
- name: backendAzureRmStorageAccountName
  default: 'terraformprod1784531786'
- name: backendAzureRmKey
  default: 'terraform-prod'

jobs:
- job:
  displayName: 'Terraform Destroy ${{ parameters.name }} Infrastructure'
  steps:
  - template: ../../Steps/Terraform/terraform-install-step.yml
    parameters:
      name: ${{ parameters.name }}
  - template: ../../Steps/Terraform/terraform-check-formatting-step.yml
    parameters:
      name: ${{ parameters.name }}
  - template: ../../Steps/Terraform/terraform-init-step.yml
    parameters:
      name: ${{ parameters.name }}
      terraformWorkingDir: ${{ parameters.terraformWorkingDir }}
      backendAzureRmContainerName: ${{ parameters.backendAzureRmContainerName }}
      environmentServiceName: ${{ parameters.environmentServiceName }}
      backendAzureRmResourceGroupName: ${{ parameters.backendAzureRmResourceGroupName }}
      backendAzureRmStorageAccountName: ${{ parameters.backendAzureRmStorageAccountName }}
      backendAzureRmKey: ${{ parameters.backendAzureRmKey }}
  - template: ../../Steps/Terraform/terraform-validate-step.yml
    parameters:
      name: ${{ parameters.name }}
      terraformWorkingDir: ${{ parameters.terraformWorkingDir }}
  - template: ../../Steps/Terraform/terraform-destroy-plan-step.yml
    parameters:
      name: ${{ parameters.name }}
      terraformWorkingDir: ${{ parameters.terraformWorkingDir }}
      environmentServiceName: ${{ parameters.environmentServiceName }}
  - template: ../../Steps/Terraform/terraform-destroy-step.yml
    parameters:
      name: ${{ parameters.name }}
      terraformWorkingDir: ${{ parameters.terraformWorkingDir }}
      environmentServiceName: ${{ parameters.environmentServiceName }}